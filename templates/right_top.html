<!DOCTYPE html>
<html>
<head>
    <title>Right Section</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>
<body>
    <h1>Star Information Display</h1>
    <div id="koi_id_container">
        <!-- The selected "koi_id" will be displayed here -->
    </div>

    <!--checkboxes -->
    <div id="checkbox_container" style="display:none;">
        <input type="checkbox" id="detrendedLCCheckbox" onchange="togglePlotVisibilityDetrendedLightCurve()" checked/> 
        <label for="detrendedLCCheckbox">Detrended Light Curve</label>

        <input type="checkbox" id="singletransitCheckbox" onchange="togglePlotVisibilitySingleTransit()"/>
        <label for="singleTransitCheckbox">Single Transit</label>

        <input type="checkbox" id="O-CCheckbox" onchange="togglePlotVisibilityDemo('O-C')"/>
        <label for="O-CCheckbox">O-C</label>

        <input type="checkbox" id="foldedLightCurveCheckbox" onchange="togglePlotVisibilityFoldedLightCurve()"/>
        <label for="foldedLightCurveCheckbox">Folded Transit</label>
    </div>

    <div id="detrendedLCTitle" style="display:none;">
        <h3>Kepler Detrended Light Curve:</h3>

        <div id="detrendedLCPlot" data-koi-id="{{ koi_id }}" style="display:none;">
            <!-- detrended light curve will display here -->
        </div>

    </div>

    <div id="singletransitTitle" style="display:none;">
        <h3>Single Transit:</h3>

        <div id="singleTransitPlot" data-koi-id="{{ koi_id }}" style="display:none;">
            <!-- single transit plot will display here -->
        </div>
    </div>

    <div id="foldedLightCurveTitle" style="display:none;">
        <h3>Folded Light Curve:</h3>

        <div id="foldedLightCurvePlot" data-koi-id="{{ koi_id }}" style="display:none;">
            <!-- folded light curve will display here -->
        </div>
    </div>


    <script>
        function generatePlotDetrendedLightCurve(koiId) {
            // Fetch the Plotly figure data from the server
            fetch(`/generate_plot/${koiId}`)
                .then(response => response.json())
                .then(data => {
                    console.log("Received data:", data); // Log the received data
                    if(data.error_message){ 
                        // Display the error message in the plot container
                        const plotContainerDetrendedLightCurve = document.getElementById("detrendedLCPlot");
                        plotContainerDetrendedLightCurve.innerHTML = `<p>${data.error_message}</p>`;
                    } else { 
                        // Clear any existing error message
                        const plotContainerDetrendedLightCurve = document.getElementById("detrendedLCPlot");
                        plotContainerDetrendedLightCurve.innerHTML = "";
                        //display plot
                        const parsedData = JSON.parse(data);
                        Plotly.newPlot(plotContainerDetrendedLightCurve, parsedData);
                    }
                })
                .catch(error => {
                    plotContainerDetrendedLightCurve.innerHTML = "<p>Error loading plot data.</p>";
                    console.error(error);
                });
        }

        function togglePlotVisibilityDetrendedLightCurve() {
            const plotContainer = document.getElementById("detrendedLCPlot");
            const plotCheckbox = document.getElementById("detrendedLCCheckbox");
            const plotTitle = document.getElementById("detrendedLCTitle");
            
            if (plotCheckbox.checked) {
                plotTitle.style.display = "block";
                plotContainer.style.display = "block";  // Show the plot
                generatePlotDetrendedLightCurve(selectedKoiId);
            } else {
                plotTitle.style.display = "none";
                plotContainer.style.display = "none";   // Hide the plot
            }

        }

        // folded light curve
        function generatePlotFoldedLightCurve(koiId) {
            // Fetch the Plotly figure data from the server
            fetch(`/generate_plot_folded_light_curve/${koiId}`)
                .then(response => response.json())
                .then(data => {
                    console.log("Received data:", data); // Log the received data
                    if(data.error_message){ 
                        // Display the error message in the plot container
                        const plotContainer = document.getElementById("foldedLightCurvePlot");
                        plotContainer.innerHTML = `<p>${data.error_message}</p>`;
                    } else { 
                        // Clear any existing error message
                        const plotContainer = document.getElementById("foldedLightCurvePlot");
                        plotContainer.innerHTML = "";
                        //display plot
                        const parsedData = JSON.parse(data);
                        Plotly.newPlot(plotContainer, parsedData);
                    }
                })
                .catch(error => {
                    plotContainerDetrendedLightCurve.innerHTML = "<p>Error loading plot data.</p>";
                    console.error(error);
                });
        }

        function togglePlotVisibilityFoldedLightCurve() {
            const plotContainer = document.getElementById("foldedLightCurvePlot");
            const plotCheckbox = document.getElementById("foldedLightCurveCheckbox");
            const plotTitle = document.getElementById("foldedLightCurveTitle");
            
            if (plotCheckbox.checked) {
                plotTitle.style.display = "block";
                plotContainer.style.display = "block";  // Show the plot
                generatePlotFoldedLightCurve(selectedKoiId);
            } else {
                plotTitle.style.display = "none";
                plotContainer.style.display = "none";   // Hide the plot
            }

        }


        // single transit
        function generatePlotSingleTransit(koiId) {
            // Fetch the Plotly figure data from the server
            fetch(`/generate_plot_single_transit/${koiId}`)
                .then(response => response.json())
                .then(data => {
                    console.log("Received data:", data); // Log the received data
                    if(data.error_message){ 
                        // Display the error message in the plot container
                        const plotContainerDetrendedLightCurve = document.getElementById("singleTransitPlot");
                        plotContainerDetrendedLightCurve.innerHTML = `<p>${data.error_message}</p>`;
                    } else { 
                        // Clear any existing error message
                        const plotContainerDetrendedLightCurve = document.getElementById("singleTransitPlot");
                        plotContainerDetrendedLightCurve.innerHTML = "";
                        //display plot
                        const parsedData = JSON.parse(data);
                        Plotly.newPlot(plotContainerDetrendedLightCurve, parsedData);
                    }
                })
                .catch(error => {
                    plotContainerDetrendedLightCurve.innerHTML = "<p>Error loading plot data.</p>";
                    console.error(error);
                });
        }

        function togglePlotVisibilitySingleTransit() {
            const plotContainer = document.getElementById("singleTransitPlot");
            const plotCheckbox = document.getElementById("singleTransitCheckbox");
            const plotTitle = document.getElementById("singleTransitTitle");
            
            if (plotCheckbox.checked) {
                plotTitle.style.display = "block";
                plotContainer.style.display = "block";  // Show the plot
                generatePlotSingleTransit(selectedKoiId);
            } else {
                plotTitle.style.display = "none";
                plotContainer.style.display = "none";   // Hide the plot
            }

        }


    </script>

</body>

</html>